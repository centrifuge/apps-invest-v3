import{B as g,P as v,F as P,G as p,Q as y,S as E,A as f,r as S}from"./iframe-Bh4nsEqh.js";import{c as U,b as x}from"./use-event-KVpjCCBj.js";import{c as d,d as A}from"./create-split-props-BLHDZ2ef.js";function O(e,t){const{state:a,send:n,context:m}=e,s=a.matches("mounted","unmountSuspended");return{skip:!m.get("initial"),present:s,setNode(o){o&&n({type:"NODE.SET",node:o})},unmount(){n({type:"UNMOUNT"})}}}var M=g({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["clearInitial","cleanupNode"],watch({track:e,action:t,prop:a}){e([()=>a("present")],()=>{t(["setInitial","syncPresence"])})},on:{"NODE.SET":{actions:["setNode","setStyles"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},invokeOnExitComplete:({prop:e})=>{var t;(t=e("onExitComplete"))==null||t()},setNode:({refs:e,event:t})=>{e.set("node",t.node)},setStyles:({refs:e,event:t})=>{e.set("styles",y(t.node))},syncPresence:({context:e,refs:t,send:a,prop:n})=>{const m=n("present");if(m)return a({type:"MOUNT",src:"presence.changed"});const s=t.get("node");if(!m&&(s==null?void 0:s.ownerDocument.visibilityState)==="hidden")return a({type:"UNMOUNT",src:"visibilitychange"});p(()=>{var r,u;const o=l(t.get("styles"));e.set("unmountAnimationName",o),o==="none"||o===e.get("prevAnimationName")||((r=t.get("styles"))==null?void 0:r.display)==="none"||((u=t.get("styles"))==null?void 0:u.animationDuration)==="0s"?a({type:"UNMOUNT",src:"presence.changed"}):a({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:t})=>{p(()=>{e.set("prevAnimationName",l(t.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:t,send:a})=>{const n=t.get("node");if(!n)return;const m=r=>{var i,c;(((c=(i=r.composedPath)==null?void 0:i.call(r))==null?void 0:c[0])??r.target)===n&&e.set("prevAnimationName",l(t.get("styles")))},s=r=>{const u=l(t.get("styles"));E(r)===n&&u===e.get("unmountAnimationName")&&a({type:"UNMOUNT",src:"animationend"})};n.addEventListener("animationstart",m),n.addEventListener("animationcancel",s),n.addEventListener("animationend",s);const o=v(n,{animationFillMode:"forwards"});return()=>{n.removeEventListener("animationstart",m),n.removeEventListener("animationcancel",s),n.removeEventListener("animationend",s),P(()=>o())}}}}});function l(e){return(e==null?void 0:e.animationName)||"none"}f()(["onExitComplete","present","immediate"]);const k=(e={})=>{const{lazyMount:t,unmountOnExit:a,present:n,skipAnimationOnMount:m=!1,...s}=e,o=S.useRef(!1),r={...s,present:n,onExitComplete:U(e.onExitComplete)},u=x(M,r),i=O(u);i.present&&(o.current=!0);const c=!i.present&&!o.current&&t||a&&!i.present&&o.current,N=()=>({"data-state":i.skip&&m?void 0:n?"open":"closed",hidden:!i.present});return{ref:i.setNode,getPresenceProps:N,present:i.present,unmounted:c}},[R,D]=d({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"}),[L,w]=d({name:"RenderStrategyContext",hookName:"useRenderStrategyContext",providerName:"<RenderStrategyPropsProvider />"}),I=e=>A()(e,["lazyMount","unmountOnExit"]);export{R as P,L as R,k as a,w as b,I as s,D as u};
